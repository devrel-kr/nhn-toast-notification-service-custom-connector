name: Release to GitHub

on:
  push:
    tags:
    - 'v*'

jobs:
  call_CI_part:
    uses: ./.github/workflows/continuous-integration.yaml
    with:
      action_name: release_github
      function_apps: '{[{"src-path":"Sms","fncapp-name":"sms"},{"src-path":"Sms.Verification","fncapp-name":"sms-verify"}]}'

  call_CD_github:
    uses: ./.github/workflows/continuous-deployment.yaml
    needs: 
    - call_CI_part
    with:
      action_name: release_github
      tag: ${{ github.ref }}
      function_apps: '{[{"src-path":"Sms","fncapp-name":"sms"},{"src-path":"Sms.Verification","fncapp-name":"sms-verify"}]}'
    secrets:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}  
      
